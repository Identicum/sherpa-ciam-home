{% extends "index.html" %}

{% block title %}{{ messages['clientcreation.title'] }}{% endblock %}

{% block content %}
<div class="container">
    <h1>{{ messages['clientcreation.title'] }}</h1>
    <form method="post" action="/clientcreation">
        {{ form.hidden_tag() }}

        <!-- Section 1: Client Info -->
        <fieldset>
            <legend>{{ messages['clientcreation.section1'] or "Client Information" }}</legend>
            <div class="form-group">
                {{ form.integrationType.label(class="form-label") }}
                {{ form.integrationType(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.realmType.label(class="form-label") }}
                {{ form.realmType(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.workspace.label(class="form-label") }}
                {{ form.workspace(class="form-control", multiple=true) }}
            </div>
            <div class="form-group">
                {{ form.clientName.label(class="form-label") }}
                {{ form.clientName(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.ownerEmail.label(class="form-label") }}
                {{ form.ownerEmail(class="form-control") }}
            </div>
            <!-- Add more fields here as needed -->
        </fieldset>

        <!-- Section 2: Redirect URIs -->
        <fieldset>
            <legend>{{ messages['clientcreation.section2'] or "Redirect URIs" }}</legend>
            <div class="form-group">
                {% for field in form.redirectUris %}
                    {{ field.label(class="form-label") }}
                    {{ field(class="form-control") }}
                {% endfor %}
                <small class="form-text text-muted">
                    {{ messages['clientcreation.redirect_uri_help'] or "Add one or more redirect URIs." }}
                </small>
            </div>
        </fieldset>

        <button type="submit" class="btn btn-primary">{{ messages['clientcreation.submit_request'] }}</button>
    </form>
    <p><a href="{{ url_for('index') }}">{{ messages['back_home'] }}</a></p>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const realmSelect = document.querySelector('select[name="realmType"]');
    const workspaceSelect = document.querySelector('select[name="workspace"]');

    if (realmSelect && workspaceSelect) {
        realmSelect.addEventListener('change', function() {
            const selectedRealm = realmSelect.value;
            fetch(`/clientcreation/workspaces?realmType=${encodeURIComponent(selectedRealm)}`)
                .then(response => response.json())
                .then(data => {
                    // Clear current options
                    workspaceSelect.innerHTML = '';
                    // Add new options
                    data.forEach(function(workspace) {
                        const option = document.createElement('option');
                        option.value = workspace;
                        option.text = workspace;
                        workspaceSelect.appendChild(option);
                    });
                });
        });
    }
});
</script>
{% endblock %}
